var Snail=function(g,q){function r(b,a,d){var c=0;b.map(function(f,e){var k=new Image;k.onload=function(){a[f[0]]=k;c++;if(c===b.length)return d()};k.src=f[1]})}function t(b,c){var d=Math.getMoveAngle(b.x,b.y,c.x,c.y,a.Angle),f=a.ratioMovingAngle.slice(0),e=a.ratioMovingDistance.slice(0),g=0,k=c.x-b.x,u=c.y-b.y,h=Array.apply(null,Array(8)).map(function(b,c){return e[c]*k+a.Position.x}),l=Array.apply(null,Array(8)).map(function(b,c){return e[c]*u+a.Position.y});f=f.map(function(b,a){return f[a]*d});
(function v(){1>h.length||(a.Canvas.style.top=l[0]+"px",a.Canvas.style.left=h[0]+"px",a.Position.x=h[0],a.Position.y=l[0],a.Context.clearRect(-1*a.CanvasSize,-1*a.CanvasSize,2*a.CanvasSize,2*a.CanvasSize),a.Context.rotate(f[0]),a.Angle=Math.addDegree(a.Angle,Math.degrees(f[0])),a.Context.drawImage(a.Sprite[g],-10,-10,20,20),h.shift(),l.shift(),f.shift(),g++,window.setTimeout(v,50))})()}function n(b,c){a.onMove=!0;(function f(){1>b.length?(c!==q&&h.remove(c),a.onMove=!1):(t(b[0].p,b[0].Np),b.shift(),
window.setTimeout(f,450))})()}function p(b,c){var d=Math.addDegree(Math.degrees(.5*Math.getMoveAngle(b.x,b.y,c.x,c.y,a.Angle)),a.Angle);d=Math.forceFoward(d,Math.sqrt((c.x-b.x)*(c.x-b.x)+(c.y-b.y)*(c.y-b.y)));d=new Bezier(b.x,b.y,b.x+d.x,b.y+d.y,c.x,c.y);var f=d.getLUT(Math.round(.1*(100>d.length()?100:d.length()))),e=[];f.map(function(b,a){if(a<f.length-1){var c={};c.p=f[a];c.Np=f[a+1];e.push(c)}});return e}Math.radians=function(b){return b*Math.PI/180};Math.degrees=function(b){return 180*b/Math.PI};
Math.addDegree=function(b,a){var c=b+a;0>c&&(c=360+c);360<c&&(c-=360);return c};Math.getMoveAngle=function(b,a,d,f,e){d-=b;f-=a;a=Math.PI/180*e;b=Math.cos(a);a=Math.sin(a);return Math.atan2(b*f-a*d,b*d+a*f)};Math.forceFoward=function(a,c){c*=.666;var b=Math.cos(Math.radians(a))*c,f=Math.sin(Math.radians(a))*c;return{x:b,y:f}};Math.getRadian=function(a,c,d){var b=Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2));c=Math.sqrt(Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2));a=Math.sqrt(Math.pow(d.x-a.x,2)+
Math.pow(d.y-a.y,2));return Math.acos((c*c+b*b-a*a)/(2*c*b))};Math.getRange=function(a,c){return Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2))};var h={set:{Canvas:[],feedList:[{},{},{}]}};g.set={Height:0,Width:0,Health:50,Canvas:null,CanvasCom:null,CanvasSize:40,Context:null,ContextCom:null,ratioMovingAngle:[.25,.12,.08,.05,.05,.08,.12,.25],ratioMovingDistance:[.05,.1,.2,.4,.75,.85,.94,1],Angle:0,Position:{x:20,y:20},firstMove:!1,onMove:!1,Sprite:null,Images:{},Imageslink:[["Carrot","images/carrot.png"],
["Snail0","images/0.png"],["Snail1","images/1.png"],["Snail2","images/2.png"],["Snail3","images/3.png"]]};var a=g.set,e=h.set;h.remove=function(b){a.Health+=20;e.feedList[b].x=!1;e.feedList[b].y=!1;e.Canvas[b].style.top="-100px";e.Canvas[b].style.left="-100px"};h.add=function(a,c){e.feedList[a].x=c.x;e.feedList[a].y=c.y;e.Canvas[a].style.top=e.feedList[a].y+10+"px";e.Canvas[a].style.left=e.feedList[a].x+10+"px"};h.setLocation=function(){document.addEventListener("click",function(a){a=a||window.event;
if(null==a.pageX&&null!=a.clientX){var c=a.target&&a.target.ownerDocument||document;var b=c.documentElement;c=c.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}a={x:a.pageX,y:a.pageY};for(b=0;b<e.feedList.length;b++)if(!1===e.feedList[b].x){h.add(b,a);break}},!0)};h.init=function(){e.feedList.map(function(a){a.x=!1;a.y=!1;return a})};g.findFeed=function(){var b=
-1,c=0,d=[0,0,0];(function m(){if(0>=a.Health)return!1;if(!0===a.onMove||80<a.Health)window.setTimeout(m,1E3);else{b=-1;c=9999999;e.feedList.map(function(b,c){d[c]=!1!==b.x?Math.getRange(a.Position,e.feedList[c]):1E7});d.map(function(a,d){a<c&&(c=a,b=d)});if(-1!==b){var g=p(a.Position,e.feedList[b]);n(g,b)}window.setTimeout(m,450)}})()};g.firstMove=function(){document.onmousemove=function(b){!1===a.firstMove&&(g.Health(),b=p(a.Position,{x:100,y:50}),n(b),a.firstMove=!0)}};g.Health=function(){(function c(){if(0===
a.Health)return a.CanvasCom.style.top=a.Position.y+"px",a.CanvasCom.style.left=a.Position.x+"px",a.ContextCom.clearRect(0,0,80,20),a.ContextCom.font="12px Comic Sans",a.ContextCom.fillText("Bye......",0,10),!1;a.CanvasCom.style.top=a.Position.y+"px";a.CanvasCom.style.left=a.Position.x+"px";a.ContextCom.clearRect(0,0,80,20);30>a.Health&&(a.CanvasCom.style.top=a.Position.y+"px",a.CanvasCom.style.left=a.Position.x+"px",a.ContextCom.clearRect(0,0,80,20),a.ContextCom.font="12px Comic Sans",a.ContextCom.fillText("I'm hungry ;;",
0,10));80<a.Health&&(a.CanvasCom.style.top=a.Position.y+"px",a.CanvasCom.style.left=a.Position.x+"px",a.ContextCom.clearRect(0,0,80,20),a.ContextCom.font="12px Comic Sans",a.ContextCom.fillText("I'm full...",0,10));a.Health=!0===a.onMove?a.Health-4:a.Health-2;a.Health=0>a.Health?0:a.Health;window.setTimeout(c,2E3)})()};g.init=function(){var b=Array.apply(null,Array(4)).map(function(b,c){return a.Images["Snail"+c]});a.Height=1024;a.Width=766;a.Canvas=document.getElementById("snail");a.CanvasCom=document.getElementById("snailComment");
a.Context=a.Canvas.getContext("2d");a.ContextCom=a.CanvasCom.getContext("2d");a.Context.translate(.5*a.CanvasSize,.5*a.CanvasSize);a.Sprite=b.concat(b.slice(0).reverse());for(b=0;3>b;b++){var c=document.getElementById("carrot"+b),d=c.getContext("2d");e.Canvas.push(c);d.drawImage(a.Images.Carrot,0,0,20,20)}h.init();h.setLocation();g.firstMove();g.findFeed()};g.start=function(){r(a.Imageslink,a.Images,g.init)};return g}(window.Snail||{});Snail.start();